{
  "tests/integration/stepfunctions/v2/scenarios/test_sfn_scenarios.py::TestFundamental::test_step_functions_calling_api_gateway": {
    "recorded-date": "03-03-2023, 15:19:42",
    "recorded-content": {
      "describe_statemachine": {
        "creationDate": "datetime",
        "definition": {
          "StartAt": "Add Pet to Store",
          "States": {
            "Add Pet to Store": {
              "Next": "Pet was Added Successfully?",
              "Type": "Task",
              "Resource": "arn:aws:states:::apigateway:invoke",
              "Parameters": {
                "ApiEndpoint": "<api-endpoint:1>",
                "Method": "POST",
                "Stage": "dev",
                "RequestBody.$": "$",
                "AuthType": "NO_AUTH"
              }
            },
            "Pet was Added Successfully?": {
              "Type": "Choice",
              "Choices": [
                {
                  "Variable": "$.ResponseBody.errors",
                  "IsPresent": true,
                  "Next": "Failure"
                }
              ],
              "Default": "Success"
            },
            "Success": {
              "Type": "Succeed"
            },
            "Failure": {
              "Type": "Fail"
            }
          }
        },
        "loggingConfiguration": {
          "includeExecutionData": false,
          "level": "OFF"
        },
        "name": "<state-machine-name>",
        "roleArn": "arn:aws:iam::111111111111:role/<role-name>",
        "stateMachineArn": "arn:aws:states:<region>:111111111111:stateMachine:<state-machine-name>",
        "status": "ACTIVE",
        "tracingConfiguration": {
          "enabled": false
        },
        "type": "STANDARD",
        "ResponseMetadata": {
          "HTTPHeaders": {},
          "HTTPStatusCode": 200
        }
      },
      "success__start_execution_result": {
        "executionArn": "arn:aws:states:<region>:111111111111:execution:<state-machine-name>:<execution-id-success>",
        "startDate": "datetime",
        "ResponseMetadata": {
          "HTTPHeaders": {},
          "HTTPStatusCode": 200
        }
      },
      "success__describe_ex_done": {
        "executionArn": "arn:aws:states:<region>:111111111111:execution:<state-machine-name>:<execution-id-success>",
        "input": {
          "fail": true
        },
        "inputDetails": {
          "included": true
        },
        "name": "<execution-id-success>",
        "startDate": "datetime",
        "stateMachineArn": "arn:aws:states:<region>:111111111111:stateMachine:<state-machine-name>",
        "status": "FAILED",
        "stopDate": "datetime",
        "ResponseMetadata": {
          "HTTPHeaders": {},
          "HTTPStatusCode": 200
        }
      },
      "success__execution_history": {
        "events": [
          {
            "executionStartedEventDetails": {
              "input": {
                "fail": true
              },
              "inputDetails": {
                "truncated": false
              },
              "roleArn": "arn:aws:iam::111111111111:role/<role-name>"
            },
            "id": 1,
            "previousEventId": 0,
            "timestamp": "timestamp",
            "type": "ExecutionStarted"
          },
          {
            "id": 2,
            "previousEventId": 0,
            "stateEnteredEventDetails": {
              "input": {
                "fail": true
              },
              "inputDetails": {
                "truncated": false
              },
              "name": "Add Pet to Store"
            },
            "timestamp": "timestamp",
            "type": "TaskStateEntered"
          },
          {
            "id": 3,
            "previousEventId": 2,
            "taskScheduledEventDetails": {
              "parameters": {
                "ApiEndpoint": "<api-endpoint:1>",
                "Method": "POST",
                "Stage": "dev",
                "AuthType": "NO_AUTH",
                "RequestBody": {
                  "fail": true
                }
              },
              "region": "<region>",
              "resource": "invoke",
              "resourceType": "apigateway"
            },
            "timestamp": "timestamp",
            "type": "TaskScheduled"
          },
          {
            "id": 4,
            "previousEventId": 3,
            "taskStartedEventDetails": {
              "resource": "invoke",
              "resourceType": "apigateway"
            },
            "timestamp": "timestamp",
            "type": "TaskStarted"
          },
          {
            "id": 5,
            "previousEventId": 4,
            "taskSucceededEventDetails": {
              "output": {
                "Headers": {
                  "Connection": [
                    "keep-alive"
                  ],
                  "Content-Length": [
                    "30"
                  ],
                  "Content-Type": [
                    "application/json"
                  ],
                  "Date": "date",
                  "Via": "via",
                  "x-amz-apigw-id": "x-amz-apigw-id",
                  "X-Amz-Cf-Id": "x--amz--cf--id",
                  "X-Amz-Cf-Pop": "x--amz--cf--pop",
                  "x-amzn-RequestId": "x-amzn--request-id",
                  "X-Amzn-Trace-Id": "x--amzn--trace--id",
                  "X-Cache": [
                    "Miss from cloudfront"
                  ]
                },
                "ResponseBody": {
                  "errors": [
                    "Errors.Failure"
                  ]
                },
                "StatusCode": 200,
                "StatusText": "OK"
              },
              "outputDetails": {
                "truncated": false
              },
              "resource": "invoke",
              "resourceType": "apigateway"
            },
            "timestamp": "timestamp",
            "type": "TaskSucceeded"
          },
          {
            "id": 6,
            "previousEventId": 5,
            "stateExitedEventDetails": {
              "name": "Add Pet to Store",
              "output": {
                "Headers": {
                  "Connection": [
                    "keep-alive"
                  ],
                  "Content-Length": [
                    "30"
                  ],
                  "Content-Type": [
                    "application/json"
                  ],
                  "Date": "date",
                  "Via": "via",
                  "x-amz-apigw-id": "x-amz-apigw-id",
                  "X-Amz-Cf-Id": "x--amz--cf--id",
                  "X-Amz-Cf-Pop": "x--amz--cf--pop",
                  "x-amzn-RequestId": "x-amzn--request-id",
                  "X-Amzn-Trace-Id": "x--amzn--trace--id",
                  "X-Cache": [
                    "Miss from cloudfront"
                  ]
                },
                "ResponseBody": {
                  "errors": [
                    "Errors.Failure"
                  ]
                },
                "StatusCode": 200,
                "StatusText": "OK"
              },
              "outputDetails": {
                "truncated": false
              }
            },
            "timestamp": "timestamp",
            "type": "TaskStateExited"
          },
          {
            "id": 7,
            "previousEventId": 6,
            "stateEnteredEventDetails": {
              "input": {
                "Headers": {
                  "Connection": [
                    "keep-alive"
                  ],
                  "Content-Length": [
                    "30"
                  ],
                  "Content-Type": [
                    "application/json"
                  ],
                  "Date": "date",
                  "Via": "via",
                  "x-amz-apigw-id": "x-amz-apigw-id",
                  "X-Amz-Cf-Id": "x--amz--cf--id",
                  "X-Amz-Cf-Pop": "x--amz--cf--pop",
                  "x-amzn-RequestId": "x-amzn--request-id",
                  "X-Amzn-Trace-Id": "x--amzn--trace--id",
                  "X-Cache": [
                    "Miss from cloudfront"
                  ]
                },
                "ResponseBody": {
                  "errors": [
                    "Errors.Failure"
                  ]
                },
                "StatusCode": 200,
                "StatusText": "OK"
              },
              "inputDetails": {
                "truncated": false
              },
              "name": "Pet was Added Successfully?"
            },
            "timestamp": "timestamp",
            "type": "ChoiceStateEntered"
          },
          {
            "id": 8,
            "previousEventId": 7,
            "stateExitedEventDetails": {
              "name": "Pet was Added Successfully?",
              "output": {
                "Headers": {
                  "Connection": [
                    "keep-alive"
                  ],
                  "Content-Length": [
                    "30"
                  ],
                  "Content-Type": [
                    "application/json"
                  ],
                  "Date": "date",
                  "Via": "via",
                  "x-amz-apigw-id": "x-amz-apigw-id",
                  "X-Amz-Cf-Id": "x--amz--cf--id",
                  "X-Amz-Cf-Pop": "x--amz--cf--pop",
                  "x-amzn-RequestId": "x-amzn--request-id",
                  "X-Amzn-Trace-Id": "x--amzn--trace--id",
                  "X-Cache": [
                    "Miss from cloudfront"
                  ]
                },
                "ResponseBody": {
                  "errors": [
                    "Errors.Failure"
                  ]
                },
                "StatusCode": 200,
                "StatusText": "OK"
              },
              "outputDetails": {
                "truncated": false
              }
            },
            "timestamp": "timestamp",
            "type": "ChoiceStateExited"
          },
          {
            "id": 9,
            "previousEventId": 8,
            "stateEnteredEventDetails": {
              "input": {
                "Headers": {
                  "Connection": [
                    "keep-alive"
                  ],
                  "Content-Length": [
                    "30"
                  ],
                  "Content-Type": [
                    "application/json"
                  ],
                  "Date": "date",
                  "Via": "via",
                  "x-amz-apigw-id": "x-amz-apigw-id",
                  "X-Amz-Cf-Id": "x--amz--cf--id",
                  "X-Amz-Cf-Pop": "x--amz--cf--pop",
                  "x-amzn-RequestId": "x-amzn--request-id",
                  "X-Amzn-Trace-Id": "x--amzn--trace--id",
                  "X-Cache": [
                    "Miss from cloudfront"
                  ]
                },
                "ResponseBody": {
                  "errors": [
                    "Errors.Failure"
                  ]
                },
                "StatusCode": 200,
                "StatusText": "OK"
              },
              "inputDetails": {
                "truncated": false
              },
              "name": "Failure"
            },
            "timestamp": "timestamp",
            "type": "FailStateEntered"
          },
          {
            "executionFailedEventDetails": {},
            "id": 10,
            "previousEventId": 9,
            "timestamp": "timestamp",
            "type": "ExecutionFailed"
          }
        ],
        "ResponseMetadata": {
          "HTTPHeaders": {},
          "HTTPStatusCode": 200
        }
      },
      "failure__start_execution_result": {
        "executionArn": "arn:aws:states:<region>:111111111111:execution:<state-machine-name>:<execution-id-failure>",
        "startDate": "datetime",
        "ResponseMetadata": {
          "HTTPHeaders": {},
          "HTTPStatusCode": 200
        }
      },
      "failure__describe_ex_done": {
        "executionArn": "arn:aws:states:<region>:111111111111:execution:<state-machine-name>:<execution-id-failure>",
        "input": {
          "fail": false
        },
        "inputDetails": {
          "included": true
        },
        "name": "<execution-id-failure>",
        "output": {
          "Headers": {
            "Connection": [
              "keep-alive"
            ],
            "Content-Length": [
              "18"
            ],
            "Content-Type": [
              "application/json"
            ],
            "Date": "date",
            "Via": "via",
            "x-amz-apigw-id": "x-amz-apigw-id",
            "X-Amz-Cf-Id": "x--amz--cf--id",
            "X-Amz-Cf-Pop": "x--amz--cf--pop",
            "x-amzn-RequestId": "x-amzn--request-id",
            "X-Amzn-Trace-Id": "x--amzn--trace--id",
            "X-Cache": [
              "Miss from cloudfront"
            ]
          },
          "ResponseBody": {
            "hello": "world"
          },
          "StatusCode": 200,
          "StatusText": "OK"
        },
        "outputDetails": {
          "included": true
        },
        "startDate": "datetime",
        "stateMachineArn": "arn:aws:states:<region>:111111111111:stateMachine:<state-machine-name>",
        "status": "SUCCEEDED",
        "stopDate": "datetime",
        "ResponseMetadata": {
          "HTTPHeaders": {},
          "HTTPStatusCode": 200
        }
      },
      "failure__execution_history": {
        "events": [
          {
            "executionStartedEventDetails": {
              "input": {
                "fail": false
              },
              "inputDetails": {
                "truncated": false
              },
              "roleArn": "arn:aws:iam::111111111111:role/<role-name>"
            },
            "id": 1,
            "previousEventId": 0,
            "timestamp": "timestamp",
            "type": "ExecutionStarted"
          },
          {
            "id": 2,
            "previousEventId": 0,
            "stateEnteredEventDetails": {
              "input": {
                "fail": false
              },
              "inputDetails": {
                "truncated": false
              },
              "name": "Add Pet to Store"
            },
            "timestamp": "timestamp",
            "type": "TaskStateEntered"
          },
          {
            "id": 3,
            "previousEventId": 2,
            "taskScheduledEventDetails": {
              "parameters": {
                "ApiEndpoint": "<api-endpoint:1>",
                "Method": "POST",
                "Stage": "dev",
                "AuthType": "NO_AUTH",
                "RequestBody": {
                  "fail": false
                }
              },
              "region": "<region>",
              "resource": "invoke",
              "resourceType": "apigateway"
            },
            "timestamp": "timestamp",
            "type": "TaskScheduled"
          },
          {
            "id": 4,
            "previousEventId": 3,
            "taskStartedEventDetails": {
              "resource": "invoke",
              "resourceType": "apigateway"
            },
            "timestamp": "timestamp",
            "type": "TaskStarted"
          },
          {
            "id": 5,
            "previousEventId": 4,
            "taskSucceededEventDetails": {
              "output": {
                "Headers": {
                  "Connection": [
                    "keep-alive"
                  ],
                  "Content-Length": [
                    "18"
                  ],
                  "Content-Type": [
                    "application/json"
                  ],
                  "Date": "date",
                  "Via": "via",
                  "x-amz-apigw-id": "x-amz-apigw-id",
                  "X-Amz-Cf-Id": "x--amz--cf--id",
                  "X-Amz-Cf-Pop": "x--amz--cf--pop",
                  "x-amzn-RequestId": "x-amzn--request-id",
                  "X-Amzn-Trace-Id": "x--amzn--trace--id",
                  "X-Cache": [
                    "Miss from cloudfront"
                  ]
                },
                "ResponseBody": {
                  "hello": "world"
                },
                "StatusCode": 200,
                "StatusText": "OK"
              },
              "outputDetails": {
                "truncated": false
              },
              "resource": "invoke",
              "resourceType": "apigateway"
            },
            "timestamp": "timestamp",
            "type": "TaskSucceeded"
          },
          {
            "id": 6,
            "previousEventId": 5,
            "stateExitedEventDetails": {
              "name": "Add Pet to Store",
              "output": {
                "Headers": {
                  "Connection": [
                    "keep-alive"
                  ],
                  "Content-Length": [
                    "18"
                  ],
                  "Content-Type": [
                    "application/json"
                  ],
                  "Date": "date",
                  "Via": "via",
                  "x-amz-apigw-id": "x-amz-apigw-id",
                  "X-Amz-Cf-Id": "x--amz--cf--id",
                  "X-Amz-Cf-Pop": "x--amz--cf--pop",
                  "x-amzn-RequestId": "x-amzn--request-id",
                  "X-Amzn-Trace-Id": "x--amzn--trace--id",
                  "X-Cache": [
                    "Miss from cloudfront"
                  ]
                },
                "ResponseBody": {
                  "hello": "world"
                },
                "StatusCode": 200,
                "StatusText": "OK"
              },
              "outputDetails": {
                "truncated": false
              }
            },
            "timestamp": "timestamp",
            "type": "TaskStateExited"
          },
          {
            "id": 7,
            "previousEventId": 6,
            "stateEnteredEventDetails": {
              "input": {
                "Headers": {
                  "Connection": [
                    "keep-alive"
                  ],
                  "Content-Length": [
                    "18"
                  ],
                  "Content-Type": [
                    "application/json"
                  ],
                  "Date": "date",
                  "Via": "via",
                  "x-amz-apigw-id": "x-amz-apigw-id",
                  "X-Amz-Cf-Id": "x--amz--cf--id",
                  "X-Amz-Cf-Pop": "x--amz--cf--pop",
                  "x-amzn-RequestId": "x-amzn--request-id",
                  "X-Amzn-Trace-Id": "x--amzn--trace--id",
                  "X-Cache": [
                    "Miss from cloudfront"
                  ]
                },
                "ResponseBody": {
                  "hello": "world"
                },
                "StatusCode": 200,
                "StatusText": "OK"
              },
              "inputDetails": {
                "truncated": false
              },
              "name": "Pet was Added Successfully?"
            },
            "timestamp": "timestamp",
            "type": "ChoiceStateEntered"
          },
          {
            "id": 8,
            "previousEventId": 7,
            "stateExitedEventDetails": {
              "name": "Pet was Added Successfully?",
              "output": {
                "Headers": {
                  "Connection": [
                    "keep-alive"
                  ],
                  "Content-Length": [
                    "18"
                  ],
                  "Content-Type": [
                    "application/json"
                  ],
                  "Date": "date",
                  "Via": "via",
                  "x-amz-apigw-id": "x-amz-apigw-id",
                  "X-Amz-Cf-Id": "x--amz--cf--id",
                  "X-Amz-Cf-Pop": "x--amz--cf--pop",
                  "x-amzn-RequestId": "x-amzn--request-id",
                  "X-Amzn-Trace-Id": "x--amzn--trace--id",
                  "X-Cache": [
                    "Miss from cloudfront"
                  ]
                },
                "ResponseBody": {
                  "hello": "world"
                },
                "StatusCode": 200,
                "StatusText": "OK"
              },
              "outputDetails": {
                "truncated": false
              }
            },
            "timestamp": "timestamp",
            "type": "ChoiceStateExited"
          },
          {
            "id": 9,
            "previousEventId": 8,
            "stateEnteredEventDetails": {
              "input": {
                "Headers": {
                  "Connection": [
                    "keep-alive"
                  ],
                  "Content-Length": [
                    "18"
                  ],
                  "Content-Type": [
                    "application/json"
                  ],
                  "Date": "date",
                  "Via": "via",
                  "x-amz-apigw-id": "x-amz-apigw-id",
                  "X-Amz-Cf-Id": "x--amz--cf--id",
                  "X-Amz-Cf-Pop": "x--amz--cf--pop",
                  "x-amzn-RequestId": "x-amzn--request-id",
                  "X-Amzn-Trace-Id": "x--amzn--trace--id",
                  "X-Cache": [
                    "Miss from cloudfront"
                  ]
                },
                "ResponseBody": {
                  "hello": "world"
                },
                "StatusCode": 200,
                "StatusText": "OK"
              },
              "inputDetails": {
                "truncated": false
              },
              "name": "Success"
            },
            "timestamp": "timestamp",
            "type": "SucceedStateEntered"
          },
          {
            "id": 10,
            "previousEventId": 9,
            "stateExitedEventDetails": {
              "name": "Success",
              "output": {
                "Headers": {
                  "Connection": [
                    "keep-alive"
                  ],
                  "Content-Length": [
                    "18"
                  ],
                  "Content-Type": [
                    "application/json"
                  ],
                  "Date": "date",
                  "Via": "via",
                  "x-amz-apigw-id": "x-amz-apigw-id",
                  "X-Amz-Cf-Id": "x--amz--cf--id",
                  "X-Amz-Cf-Pop": "x--amz--cf--pop",
                  "x-amzn-RequestId": "x-amzn--request-id",
                  "X-Amzn-Trace-Id": "x--amzn--trace--id",
                  "X-Cache": [
                    "Miss from cloudfront"
                  ]
                },
                "ResponseBody": {
                  "hello": "world"
                },
                "StatusCode": 200,
                "StatusText": "OK"
              },
              "outputDetails": {
                "truncated": false
              }
            },
            "timestamp": "timestamp",
            "type": "SucceedStateExited"
          },
          {
            "executionSucceededEventDetails": {
              "output": {
                "Headers": {
                  "Connection": [
                    "keep-alive"
                  ],
                  "Content-Length": [
                    "18"
                  ],
                  "Content-Type": [
                    "application/json"
                  ],
                  "Date": "date",
                  "Via": "via",
                  "x-amz-apigw-id": "x-amz-apigw-id",
                  "X-Amz-Cf-Id": "x--amz--cf--id",
                  "X-Amz-Cf-Pop": "x--amz--cf--pop",
                  "x-amzn-RequestId": "x-amzn--request-id",
                  "X-Amzn-Trace-Id": "x--amzn--trace--id",
                  "X-Cache": [
                    "Miss from cloudfront"
                  ]
                },
                "ResponseBody": {
                  "hello": "world"
                },
                "StatusCode": 200,
                "StatusText": "OK"
              },
              "outputDetails": {
                "truncated": false
              }
            },
            "id": 11,
            "previousEventId": 10,
            "timestamp": "timestamp",
            "type": "ExecutionSucceeded"
          }
        ],
        "ResponseMetadata": {
          "HTTPHeaders": {},
          "HTTPStatusCode": 200
        }
      }
    }
  }
}
